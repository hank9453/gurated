from chromadb import PersistentClient
from sentence_transformers import SentenceTransformer
import json
# 生成 20 個與《資通安全管理法》第 1-5 條相關的問題，但不直接提及法條
rag_related_questions_20 = [
        {
            "chapter": "資通安全管理法第 1 條",
            "question": "為何政府需要推動資通安全政策？"
        },
        {
            "chapter": "資通安全管理法第 2 條",
            "question": "本法的主管機關是哪個單位？"
        },
        {
            "chapter": "資通安全管理法第 3 條",
            "question": "資通安全的定義為何？"
        },
        {
            "chapter": "資通安全管理法第 4 條",
            "question": "政府為何要整合民間與產業力量提升資通安全？"
        },
        {
            "chapter": "資通安全管理法第 5 條",
            "question": "主管機關應定期公布哪些資通安全相關報告？"
        },
        {
            "chapter": "資通安全管理法第 6 條",
            "question": "主管機關可否委任或委託其他單位辦理資通安全相關事務？"
        },
        {
            "chapter": "資通安全管理法第 7 條",
            "question": "資通安全責任等級如何分級？"
        },
        {
            "chapter": "資通安全管理法第 8 條",
            "question": "主管機關應建立何種資通安全相關機制？"
        },
        {
            "chapter": "資通安全管理法第 9 條",
            "question": "公務機關在委外辦理資通系統建置時應注意哪些事項？"
        },
        {
            "chapter": "資通安全管理法第 10 條",
            "question": "公務機關應如何訂定資通安全維護計畫？"
        },
        {
            "chapter": "資通安全管理法第 11 條",
            "question": "資通安全長的主要職責為何？"
        },
        {
            "chapter": "資通安全管理法第 12 條",
            "question": "公務機關每年應向哪個單位提交資通安全維護計畫的實施情形？"
        },
        {
            "chapter": "資通安全管理法第 13 條",
            "question": "受稽核機關發現資通安全維護計畫有缺失時，應採取何種措施？"
        },
        {
            "chapter": "資通安全管理法第 14 條",
            "question": "公務機關應如何應對資通安全事件？"
        },
        {
            "chapter": "資通安全管理法第 15 條",
            "question": "如何獎勵在資通安全維護上表現優良的公務機關人員？"
        },
        {
            "chapter": "資通安全管理法第 16 條",
            "question": "關鍵基礎設施提供者應如何落實資通安全維護計畫？"
        },
        {
            "chapter": "資通安全管理法第 17 條",
            "question": "特定非公務機關應如何執行資通安全維護計畫？"
        },
        {
            "chapter": "資通安全管理法第 18 條",
            "question": "特定非公務機關發生資通安全事件時應如何通報？"
        },
        {
            "chapter": "資通安全管理法第 19 條",
            "question": "若公務機關人員未遵守本法規定，將面臨何種處罰？"
        },
        {
            "chapter": "資通安全管理法第 20 條",
            "question": "特定非公務機關未落實資通安全維護計畫將面臨哪些罰則？"
        },
        {
            "chapter": "資通安全管理法第 21 條",
            "question": "特定非公務機關若未通報資通安全事件，將會受到何種處罰？"
        },
        {
            "chapter": "資通安全管理法施行細則第 1 條",
            "question": "本細則是依據哪一條法規訂定的？"
        },
        {
            "chapter": "資通安全管理法施行細則第 2 條",
            "question": "施行細則中對軍事機關與情報機關的定義是什麼？"
        },
        {
            "chapter": "資通安全管理法施行細則第 3 條",
            "question": "改善報告應包含哪些內容？"
        },
        {
            "chapter": "資通安全管理法施行細則第 4 條",
            "question": "受託者在執行資通系統建置時，應具備哪些資通安全管理措施？"
        },
        {
            "chapter": "資通安全管理法施行細則第 5 條",
            "question": "依據電子簽章法，哪些書面文件可以使用電子文件方式呈現？"
        },
        {
            "chapter": "資通安全管理法施行細則第 6 條",
            "question": "資通安全維護計畫應包含哪些要素？"
        },
        {
            "chapter": "資通安全管理法施行細則第 7 條",
            "question": "施行細則如何定義核心業務？"
        },
        {
            "chapter": "資通安全管理法施行細則第 8 條",
            "question": "資通安全事件調查報告應包含哪些內容？"
        },
        {
            "chapter": "資通安全管理法施行細則第 9 條",
            "question": "在指定關鍵基礎設施提供者之前，主管機關應給予哪些機會？"
        },
        {
            "chapter": "資通安全管理法施行細則第 10 條",
            "question": "重大資通安全事件的標準是什麼？"
        },
        {
            "chapter": "資通安全管理法施行細則第 11 條",
            "question": "主管機關在公告重大資通安全事件時應載明哪些資訊？"
        },
        {
            "chapter": "資通安全管理法施行細則第 12 條",
            "question": "當特定非公務機關涉及多個中央目的事業主管機關時，主管機關應如何協調處理？"
        },
                {
            "chapter": "資通安全管理法第 1 條",
            "question": "確保資訊與通訊技術的穩定性對國家發展有何影響？有哪些可能的風險需要預防？"
        },
        {
            "chapter": "資通安全管理法第 2 條",
            "question": "在行政決策中，哪個單位負責資訊與通訊相關事務的監督與推動？它如何影響國內產業發展？"
        },
        {
            "chapter": "資通安全管理法第 3 條",
            "question": "在數位基礎設施中，如何區分『系統』與『服務』？這兩者在資源配置上有何異同？"
        },
        {
            "chapter": "資通安全管理法第 4 條",
            "question": "提升數位安全意識需要哪些關鍵措施？政府與企業應如何分工合作？"
        },
        {
            "chapter": "資通安全管理法第 5 條",
            "question": "資訊安全的政策應該如何與國際趨勢接軌？有哪些定期監測與評估的方法？"
        },
        {
            "chapter": "資通安全管理法第 6 條",
            "question": "在跨機構合作時，如何確保機密資訊不被洩露？有哪些技術或機制可以加強這方面的防護？"
        },
        {
            "chapter": "資通安全管理法第 7 條",
            "question": "不同機構在資訊安全上的責任應如何分類？分級管理的標準通常基於哪些考量因素？"
        },
        {
            "chapter": "資通安全管理法第 8 條",
            "question": "建立共享資訊的平台有何挑戰？應如何確保資訊流通的安全性？"
        },
        {
            "chapter": "資通安全管理法第 9 條",
            "question": "當企業將資訊處理服務外包時，應該如何選擇合適的承包商？有什麼標準可以用來評估承包商的可靠性？"
        },
        {
            "chapter": "資通安全管理法第 10 條",
            "question": "不同機構應如何設計並執行其資訊防護計畫？這些計畫如何根據機構的規模與性質進行調整？"
        },
        {
            "chapter": "資通安全管理法第 11 條",
            "question": "在組織內部，誰應該負責推動資訊安全策略？這個角色應具備哪些專業能力？"
        },
        {
            "chapter": "資通安全管理法第 12 條",
            "question": "組織在年度資訊安全審查時，應提交哪些關鍵報告？這些報告應包含哪些具體資訊？"
        },
        {
            "chapter": "資通安全管理法第 13 條",
            "question": "如果資訊安全計畫的執行效果不佳，應如何應對？是否有標準化的改善流程？"
        },
        {
            "chapter": "資通安全管理法第 14 條",
            "question": "遇到資訊系統異常時，組織應如何建立通報與應變流程？這些流程如何確保應變迅速有效？"
        },
        {
            "chapter": "資通安全管理法第 15 條",
            "question": "如何衡量資訊防護措施的有效性？有哪些方式可以激勵員工更積極參與資訊安全管理？"
        },
        {
            "chapter": "資通安全管理法第 16 條",
            "question": "某些基礎設施一旦受到攻擊，可能導致嚴重後果。這類系統應如何加強保護？"
        },
        {
            "chapter": "資通安全管理法第 17 條",
            "question": "非政府組織在管理資訊風險時，應該考量哪些因素？其防護計畫應與哪些單位合作？"
        },
        {
            "chapter": "資通安全管理法第 18 條",
            "question": "當發生大規模資訊攻擊時，應如何分階段處理？應該如何建立資訊通報機制？"
        },
        {
            "chapter": "資通安全管理法第 19 條",
            "question": "若某機構內部人員未遵守資安規範，可能會造成哪些後果？應如何建立內部稽核機制？"
        },
        {
            "chapter": "資通安全管理法第 20 條",
            "question": "如果某機構未落實資訊保護計畫，是否會有相關罰則？有哪些方法可以避免此類情況？"
        },
        {
            "chapter": "資通安全管理法第 21 條",
            "question": "當機構發現重大安全問題時，為何需要迅速通報？如果未通報，可能帶來哪些影響？"
        },
        {
            "chapter": "資通安全管理法施行細則第 1 條",
            "question": "制度運行時，為何需要施行細則？這些細則如何確保主要規範的落實？"
        },
        {
            "chapter": "資通安全管理法施行細則第 2 條",
            "question": "某些機構的運作涉及國家安全，其管理方式與一般機構有何不同？"
        },
        {
            "chapter": "資通安全管理法施行細則第 3 條",
            "question": "在執行審查與改善計畫時，應如何追蹤改進措施的效果？"
        },
        {
            "chapter": "資通安全管理法施行細則第 4 條",
            "question": "當企業選擇外部合作夥伴時，應如何評估對方的資訊防護能力？"
        },
        {
            "chapter": "資通安全管理法施行細則第 5 條",
            "question": "數位簽章如何影響電子文件的可信度？有什麼技術可用來驗證文件真偽？"
        },
        {
            "chapter": "資通安全管理法施行細則第 6 條",
            "question": "在規劃資訊防護計畫時，應考慮哪些關鍵要素？不同組織的需求是否相同？"
        },
        {
            "chapter": "資通安全管理法施行細則第 7 條",
            "question": "如何識別核心業務？哪些業務需要更嚴格的資訊防護措施？"
        },
        {
            "chapter": "資通安全管理法施行細則第 8 條",
            "question": "若發生資訊安全事件，應如何記錄並分析原因？這些記錄對未來決策有何幫助？"
        },
        {
            "chapter": "資通安全管理法施行細則第 9 條",
            "question": "當某機構被指定為關鍵基礎設施提供者時，為何需要先讓其表達意見？"
        },
        {
            "chapter": "資通安全管理法施行細則第 10 條",
            "question": "什麼類型的資安事件應被視為重大？如何區分其嚴重程度？"
        },
        {
            "chapter": "資通安全管理法施行細則第 11 條",
            "question": "當對外公告重大安全事件時，哪些資訊應保密？如何平衡透明度與隱私保護？"
        },
        {
            "chapter": "資通安全管理法施行細則第 12 條",
            "question": "當一項業務涉及多個機構時，應如何確保資訊保護的責任分配明確？"
        }
]


# 初始化 BGE-M3 模型
embed_model = SentenceTransformer("BAAI/bge-m3")


persist_directory = "/Users/hank/Desktop/project/chroma"
client = PersistentClient(path=persist_directory)
collection = client.get_or_create_collection("law_articles")

accuray = 0
loss = 0

for each in rag_related_questions_20:
    query_embedding = embed_model.encode(each['question']).tolist()
    results = collection.query(
    query_embeddings=[query_embedding],
    n_results= 2 # 取回 5 個最相關的結果
    )
    # Check if the correct article appears in the results
    found = False
    for metadata in results['metadatas'][0]:
        if metadata['chapter'] == each['chapter']:
            
            accuray += 1
            found = True
            break
    if not found:
        loss += 1

